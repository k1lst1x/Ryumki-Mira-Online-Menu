    {% extends "menuapp/base.html" %}
    {% load static %}
    {% load i18n %}
    {% block title %}{% trans "–ú–µ–Ω—é —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞" %}{% endblock %}

    {% block content %}
    <div class="container">

      <!-- üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –±–ª—é–¥–∞ -->
      <h2>{% trans "–ó–æ–ª–æ—Ç–æ–π —à—Ç–∞–º–ø –≤–∫—É—Å–∞" %}</h2>
      <p class="section-subtitle">{% trans "–¢–æ, —á—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç —á–∞—â–µ –≤—Å–µ–≥–æ" %}</p>

      <div class="scroll-container">
        <div class="scroll-row" id="popularRow" role="list" aria-label="{% trans '–ó–æ–ª–æ—Ç–æ–π —à—Ç–∞–º–ø –≤–∫—É—Å–∞' %}">
          {% for d in popular_dishes %}
            {% if not d.category.is_21plus %}
              <a class="popular-card popular-link" role="listitem">
                <div class="popular-img">
                  {% if d.image %}
                    <img src="{{ d.image.url }}" alt="{{ d.name }}">
                  {% else %}
                    <img src="{% static 'img/placeholder-dish.jpg' %}" alt="{{ d.name }}">
                  {% endif %}
                </div>
                <h3 class="popular-title">{{ d.name }}</h3>
                <span class="popular-price">{{ d.base_price }} ‚Ç∏</span>
              </a>
            {% endif %}
          {% empty %}
            <span class="muted">{% trans "–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–ª—é–¥." %}</span>
          {% endfor %}
        </div>
      </div>

      <hr class="section-sep">

      <!-- üìñ –í—Å—ë –º–µ–Ω—é ‚Äî –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
      <h2>{% trans "–ì–ª–æ–±—É—Å –í–∫—É—Å–∞" %}</h2>
      <p class="section-subtitle">{% trans "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å. –õ–∏—Å—Ç–∞–π –≤–Ω–∏–∑." %}</p>

      {% for category in categories %}
        <h3 class="category-heading">
          {{ category.name }}
          {% if category.is_21plus %}
            <span class="badge-21">21+</span>
          {% endif %}
        </h3>

        <div class="passport-grid">
          {% for dish in category.dishes.all %}
            {% if dish.is_available %}
              {% with is21=category.is_21plus %}
              <a class="menu-link {% if is21 %}requires-21{% endif %}"
                 {% if is21 %}data-requires-age="21"{% endif %}>

                <article class="passport-card"
                         style="--passport:url('{% if dish.passport_bg %}{{ dish.passport_bg.url }}{% else %}{% static 'img/passport-page.png' %}{% endif %}')">

                  <!-- –ª–µ–≤–∞—è —á–∞—Å—Ç—å: —Ñ–æ—Ç–æ –±–ª—é–¥–∞ –ø–æ–≤–µ—Ä—Ö –ø–∞—Å–ø–æ—Ä—Ç–∞ -->
                  <div class="pc-photo {% if is21 %}requires-21-visual{% endif %}">
                    {% if dish.image %}
                      <img src="{{ dish.image.url }}" alt="{{ dish.name }}">
                    {% else %}
                      <img src="{% static 'img/placeholder-dish.jpg' %}" alt="{{ dish.name }}">
                    {% endif %}
                  </div>

                  <!-- –ø—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –Ω–∏–∑: [—Ü–µ–Ω–∞] ...... [21+] -->
                  <div class="pc-info">
                    <h3 class="pc-title ellipsis-2">{{ dish.name }}</h3>
                    <p class="pc-desc">
                      {% if dish.description %}{{ dish.description }}{% else %}{% trans "–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç" %}{% endif %}
                    </p>

                    <div class="pc-meta">
                      <span class="pc-price">{{ dish.base_price }} ‚Ç∏</span>
                      {% if is21 %}
                        <span class="badge-21 pc-badge" style="margin-left:auto">21+</span>
                      {% endif %}
                    </div>
                  </div>

                </article>
              </a>
              {% endwith %}
            {% endif %}
          {% empty %}
            <p class="muted">{% trans "–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –±–ª—é–¥." %}</p>
          {% endfor %}
        </div>
      {% endfor %}

    </div>

    <script>
    (function () {
      const row = document.getElementById('popularRow');
      if (!row) return;

      const cloneChildrenOnce = () => {
        if (row.dataset.loopReady) return;
        row.dataset.loopReady = '1';
        const kids = Array.from(row.children);
        kids.forEach(k => row.appendChild(k.cloneNode(true)));
      };

      cloneChildrenOnce();
      let half = row.scrollWidth / 2;

      function normalize() {
        if (row.scrollLeft >= half) row.scrollLeft -= half;
        else if (row.scrollLeft < 0) row.scrollLeft += half;
      }

      row.addEventListener('scroll', normalize, { passive: true });
      window.addEventListener('resize', () => { half = row.scrollWidth / 2; });

      let rafId = null;
      function tick() {
        row.scrollLeft += 1;
        normalize();
        rafId = requestAnimationFrame(tick);
      }
      function startAuto() { if (!rafId) rafId = requestAnimationFrame(tick); }
      function stopAuto()  { if (rafId) cancelAnimationFrame(rafId), rafId = null; }

      startAuto();

      row.addEventListener('mouseenter', stopAuto);
      row.addEventListener('mouseleave', () => setTimeout(startAuto, 800));
      row.addEventListener('touchstart', stopAuto, { passive: true });
      row.addEventListener('touchend',   () => setTimeout(startAuto, 800), { passive: true });
    })();
    </script>
    {% endblock %}
